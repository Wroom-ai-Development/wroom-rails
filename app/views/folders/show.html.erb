<%= turbo_frame_tag 'view_content' do %>
  <%= turbo_stream_from current_user.id, 'folders' %>
  <%= turbo_stream_from current_user.id, 'folder_documents' %>
  <% drag_actions = "dragstart->drag#drag_start dragover->drag#drag_over dragenter->drag_enter drop->drag#drop dragend->drag#drag_end" %>
  <div class="header">
    <span><%= @folder.type == 'RootFolder' ? 'My Files' : @folder.name %></span>
    <% unless @folder.type == 'RootFolder' %>
      <div class="controls">
        <%= link_to "Rename", edit_folder_path(@folder), data: { turbo_frame: '_top' } %>
        <%= button_to "❌", @folder, method: :delete, id: 'delete-button',
          form: {
            id: 'delete-form',
            data: {
                turbo: false,
                controller: "confirmation",
                action: 'submit->confirmation#confirm',
                confirmation_message_value: "Please confirm you meant to delete #{@folder.name}",
            }
          } %>
          <i class="fa-solid fa-trash fa-fw delete-icon" onClick="document.getElementById('delete-button').click();"></i>
      </div>
    <% end %>
  </div>
  <div class="folder-content">
    <% if @folder.type == 'RootFolder' && @folder.empty? %>
      <div class="no-content">
        <h3>Welcome to WROOM</h3>
        <p>Click the "New" button to create a new folder or document.</p>
        <div class="haiku">
          <%= simple_format(@haiku) %>
        </div>
      </div>
    <% else %>
    <table class="folder-contents-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Created</th>
          <th>Last accessed</th>
          <th>Type</th>
          <th></th>
          <th></th>
        </tr>
      </thead>
      <tbody id='draggables'>
        <% unless @folder.type == 'RootFolder' %>
          <%= content_tag :tr, id: "folder-row-parent",
           class: 'draggable',
           onclick: 'document.getElementById("parent_link").click();',
           data: {
            controller: 'drag',
            action: drag_actions,
            resource_id: @folder.parent.id,
            draggable_type: 'folder',
            url: drag_folder_path
          } do %>
            <td>
              <%= link_to folder_path(@folder.parent), id: 'parent_link', data: { turbo_action: 'replace' } do %>
              <i class="fa fa-folder fa-fw" style="margin-right: 0.3rem;"></i>..
              <% end %>
            </td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          <% end %>
        <% end %>
        <% @folder.children.kept.each do |folder| %>
          <%= content_tag :tr, id: "folder-row-#{folder.id}", class: 'draggable', draggable: true, data: {
            controller: 'drag',
            action: drag_actions,
            resource_id: folder.id,
            draggable_type: 'folder',
            url: drag_folder_path
          } do %>
            <td onclick='document.getElementById("<%= "folder-#{folder.id}" %>").click();'>
              <%= link_to folder, id: "folder-#{folder.id}", data: { turbo_action: 'replace' } do %>
                <i class="fa fa-folder fa-fw" style="margin-right: 0.3rem;"></i><%= folder.name %>
              <% end %>
            </td>
            <td onclick='document.getElementById("<%= "folder-#{folder.id}" %>").click();'><%= folder.created_at.strftime("%b %d, %Y %H:%M") %></td>
            <td onclick='document.getElementById("<%= "folder-#{folder.id}" %>").click();'><%= folder.updated_at.strftime("%b %d, %Y %H:%M") %></td>
            <td onclick='document.getElementById("<%= "folder-#{folder.id}" %>").click();'>
              Folder
            </td>
            <td>
              <%= button_to "❌", folder, method: :delete, id: "delete-folder-button-#{folder.id}",
              form: {
                id: 'delete-form',
                data: {
                    turbo: false,
                    controller: "confirmation",
                    action: 'submit->confirmation#confirm',
                    confirmation_message_value: "Please confirm you meant to delete #{folder.name}",
                }
              } %>
              <i class="fa-solid fa-trash fa-fw delete-icon" onClick="document.getElementById('delete-folder-button-<%= folder.id %>').click();"></i>
            </td>
            <td>
              <i class="fa-solid fa-grip-vertical"></i>
            </td>
          <% end %>
        <% end %>
        <% @folder.documents.kept.each do |document| %>
          <%= content_tag :tr, id: "document-row-#{document.id}", class: 'draggable', draggable: true, data: {
            controller: 'drag',
            action: drag_actions,
            resource_id: document.id,
            draggable_type: 'document',
            url: drag_document_path
          } do %>
            <td onclick='document.getElementById("<%= "document-#{document.id}" %>").click();'><%= link_to wroom_path(document_id: document.id), id: "document-#{document.id}", data: { turbo_frame: '_top' } do %>
              <% if document.source_based %>
                <i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>
              <% else %>
                <i class="fa fa-book fa-fw" aria-hidden="true"></i>
              <% end %>
              <%= document.title %>
            <% end %></td>
            <td onclick='document.getElementById("<%= "document-#{document.id}" %>").click();'<%= document.created_at.strftime("%b %d, %Y %H:%M") %></td>
            <td onclick='document.getElementById("<%= "document-#{document.id}" %>").click();'><%= document.updated_at.strftime("%b %d, %Y %H:%M") %></td>
            <td onclick='document.getElementById("<%= "document-#{document.id}" %>").click();'>
              <%= document.source_based ? "Source" : "Document" %>
            </td>
            <td>
              <%= button_to "❌", document, method: :delete, id: "delete-document-button-#{document.id}",
              form: {
                id: 'delete-form',
                data: {
                    turbo: false,
                    controller: "confirmation",
                    action: 'submit->confirmation#confirm',
                    confirmation_message_value: "Please confirm you meant to delete #{document.title}",
                }
              } %>
              <i class="fa-solid fa-trash fa-fw delete-icon" onClick="document.getElementById('delete-document-button-<%= document.id %>').click();"></i>
            </td>
            <td>
              <i class="fa-solid fa-grip-vertical"></i>
            </td>
          <% end %>
        <% end %>
      </table>
    <% end %>


  </div>
<% end %>
