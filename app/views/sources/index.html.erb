<div class='view-header'>
  <h1>Sources</h1>
  <%= link_to "+", new_source_path %>
</div>
<div class='view-content'>
  <% if current_user.admin? %>
    <div class='index-separator'>My sources</div class='index-separator'>
  <% end %>
  <ul class="index-list">
    <% current_user.sources.order(:name).each do |source| %>
      <% if can? :manage, source %>
        <li class='index-list-item'>
          <%= link_to source.name.present? ? source.name : (source.title || "Source ID: #{source.id}"), source %>
          <div class="controls">
            <%= link_to "✍︎", edit_source_path(source) %>
            <%= button_to "␡", source, method: :delete, data: {turbo_method: :delete, turbo_confirm: "Please confirm you meant to delete #{source.name}"} %>
          </div>
        </li>
      <% end %>
    <% end %>
  </ul>
  <% if current_user.admin? %>
      <% @users.each do |user| %>
        <div class='index-separator'><%= user.email %></div>
        <ul class="index-list">
          <% user.sources.order(:name).each do |source| %>
            <li class='index-list-item'>
              <%= link_to source.name, source %>
              <div class="controls">
                <%= link_to "✍︎", edit_source_path(source) %>
                <%= button_to "␡", source, method: :delete, data: {turbo_method: :delete, turbo_confirm: "Please confirm you meant to delete #{source.name}"} %>
              </div>
            </li>
          <% end %>
        </ul>
      <% end %>
  <% end %>
</div>
